generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id          String   @id @default(uuid())
  email       String   @unique
  password    String
  role        Role
  name        String?
  phone       String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum Role {
  MANAGER
  DISPATCHER
  ACCOUNTING
}

model Customer {
  id           String   @id @default(uuid())
  name         String
  vatNumber    String?
  contactName  String?
  email        String?
  phone        String?
  billingTerms Int?
  creditLimit  Float? 
  createdAt    DateTime @default(now())
  orders       Order[]
}

model Carrier {
  id         String   @id @default(uuid())
  name       String
  contact    String?
  email      String?
  phone      String?
  rating     Float?
  createdAt  DateTime @default(now())
  orders     Order[]
}

model Vehicle {
  id            String   @id @default(uuid())
  registration  String   @unique
  type          String?
  capacityM3    Float?
  maxWeightKg   Float?
  currentStatus String?
  driverId      String?
  createdAt     DateTime @default(now())
}

model Driver {
  id            String   @id @default(uuid())
  name          String
  phone         String?
  licenseNumber String?
  carrierId     String?
  createdAt     DateTime @default(now())
}

model Order {
  id                 String   @id @default(uuid())
  orderNumber        String   @unique
  customerId         String?
  customer           Customer? @relation(fields: [customerId], references: [id])
  carrierId          String?
  carrier            Carrier?  @relation(fields: [carrierId], references: [id])
  origin             String?
  destination        String?
  etaLoad            DateTime?
  etaDelivery        DateTime?
  weightKg           Float?
  volumeM3           Float?
  status             OrderStatus  @default(PLANNED)
  assignedVehicleId  String?
  assignedDriverId   String?
  price              Float?
  cost               Float?
  notes              String?
  createdAt          DateTime @default(now())
  events             OrderEvent[]
}

enum OrderStatus {
  DRAFT
  PLANNED
  ASSIGNED
  LOADING
  LOADED
  IN_TRANSIT
  DELIVERED
  CANCELLED
}

model OrderEvent {
  id        String   @id @default(uuid())
  orderId   String
  order     Order    @relation(fields: [orderId], references: [id])
  actorType String
  actorId   String?
  eventType String
  details   Json?
  location  String?
  timestamp DateTime @default(now())
}

model Invoice {
  id          String   @id @default(uuid())
  invoiceNumber String @unique
  orderId     String?
  customerId  String?
  amountNet   Float
  vatAmount   Float
  total       Float
  status      InvoiceStatus @default(DRAFT)
  dueDate     DateTime?
  createdAt   DateTime @default(now())
}

enum InvoiceStatus {
  DRAFT
  SENT
  PAID
  OVERDUE
}

model SignedLink {
  id          String   @id @default(uuid())
  tokenHash   String   @unique
  purpose     String
  orderId     String?
  recipient   String?
  expiresAt   DateTime
  usedAt      DateTime?
  createdAt   DateTime @default(now())
}
